generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id            String          @id @default(cuid())
  name          String
  email         String          @unique
  phonenumber   String?         @unique
  password      String
  refreshToken  String?
  emailVerified Boolean         @default(false)
  phoneVerified Boolean         @default(false)
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  activationCode String?
  verifiedAt    DateTime?
  resetCode     String?
  isDeleted     Boolean         @default(false)
  deletedAt     DateTime?
  Content       Content[]
  CustomerBots  CustomerBots[]
  CustomerChats CustomerChats[]
  Quota         Quota[]
  Storage       Storage[]
}

model Quota {
  id        String     @id @default(cuid())
  userId    String
  quotaType QuotaType?
  limit     Int        @default(0)
  used      Int        @default(0)
  user      User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, quotaType])
}

model Storage {
  id            String    @id @default(cuid())
  userId        String
  botId         String
  fileName      String
  fileUrl       String
  type          String
  size          String
  status        String
  taskId        String
  ingestionInfo Json?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  deletedAt     DateTime?
  isDeleted     Boolean   @default(false)
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Content {
  id            String    @id @default(cuid())
  userId        String
  botId         String
  content       Json?
  type          String
  status        String
  taskId        String
  ingestionInfo Json?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  deletedAt     DateTime?
  isDeleted     Boolean   @default(false)
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model CustomerBots {
  id           String    @id @default(cuid())
  userId       String
  botName      String
  botAvatar    String
  systemPrompt String    @default("")
  settings     Json?
  active       Boolean   @default(false)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  isDeleted    Boolean   @default(false)
  deletedAt    DateTime?
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model CustomerChats {
  id                  String                @id @default(cuid())
  userId              String
  botId               String
  chatId              String
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt
  isDeleted           Boolean               @default(false)
  deletedAt           DateTime?
  totalTokens         Int?
  CustomerChatDetails CustomerChatDetails[]
  user                User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  GeoLocation         GeoLocation[]
}

model CustomerChatDetails {
  id           String        @id @default(cuid())
  chatId       String
  message      String
  sender       String
  tokenDetails Json?
  createdAt    DateTime      @default(now())
  chat         CustomerChats @relation(fields: [chatId], references: [id], onDelete: Cascade)
}

model GeoLocation {
  id                String        @id @default(cuid())
  chatId            String
  ip                String
  country           String
  countryCode       String
  region            String
  city              String
  timezone          String
  organization      String
  organization_name String
  latitude          Float
  longitude         Float
  accuracy          Int
  createdAt         DateTime      @default(now())
  chat              CustomerChats @relation(fields: [chatId], references: [id], onDelete: Cascade)
}

model fastapi_ingestiontask {
  task_id       String   @id @db.VarChar
  customer_cuid String   @db.VarChar
  bot_cuid      String   @db.VarChar
  status        String   @db.VarChar
  error_message String?  @db.VarChar
  created_at    DateTime @db.Timestamp(6)
  updated_at    DateTime @db.Timestamp(6)

  @@index([bot_cuid], map: "ix_fastapi_ingestiontask_bot_cuid")
  @@index([customer_cuid], map: "ix_fastapi_ingestiontask_customer_cuid")
}

enum QuotaType {
  BOT
  FILE
  TOKEN
}
